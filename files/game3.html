<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Runner War 3D</title>
  <style>
    html, body { width:100%; height:100%; margin:0; overflow:hidden; background:#000; font-family: Arial, sans-serif; }
    #renderCanvas { width:100%; height:100%; display:block; }
    #hud, #menu, #gameover, #characterSelect, #splash {
      position: absolute; top:0; left:0; width:100%; height:100%;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      color:white; z-index:20; font-size:22px; text-align:center;
    }
    button {
      margin: 10px; padding: 12px 24px; font-size: 18px; border:none; border-radius:8px; cursor:pointer;
      background: linear-gradient(90deg, #00c6ff, #0072ff); color:white; font-weight:bold;
    }
    #hud { background:none; flex-direction:row; justify-content:space-between; padding:10px; font-size:20px; }
    #hud span { margin: 0 20px; }
    #menu, #gameover, #characterSelect, #splash { display:none; background:rgba(0,0,0,0.6); }
    #splash h1 { font-size: 40px; color: #7cf3ff; text-shadow: 0 0 10px #00eaff; }
  </style>
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
</head>
<body>
  <canvas id="renderCanvas"></canvas>

  <div id="splash">
    <h1>Runner War 3D</h1>
    <p>Loading...</p>
  </div>

  <div id="menu">
    <h2>Main Menu</h2>
    <button onclick="startCharacterSelect()">Play</button>
    <button onclick="quitGame()">Quit</button>
  </div>

  <div id="characterSelect">
    <h2>Select Character</h2>
    <button onclick="startGame('male')">Male Runner</button>
    <button onclick="startGame('female')">Female Runner</button>
  </div>

  <div id="hud">
    <span>Score: <span id="score">0</span></span>
    <span>Coins: <span id="coins">0</span></span>
  </div>

  <div id="gameover">
    <h2>Game Over</h2>
    <p>Your Score: <span id="finalScore">0</span></p>
    <button onclick="restartGame()">Restart</button>
    <button onclick="goHome()">Home</button>
  </div>

  <script>
    const canvas = document.getElementById("renderCanvas");
    const engine = new BABYLON.Engine(canvas, true);
    let scene, player, lane, jumping, velocityY, sliding, score, coins, objects, gameRunning=false, charType="male";

    function show(id) {
      document.querySelectorAll("#menu,#hud,#gameover,#characterSelect,#splash").forEach(e=>e.style.display="none");
      document.getElementById(id).style.display="flex";
    }

    function quitGame() { alert("Thanks for playing Runner War 3D!"); }
    function startCharacterSelect() { show("characterSelect"); }
    function goHome() { show("menu"); }
    function restartGame() { startGame(charType); }

    function startGame(type) {
      charType = type;
      show("hud");
      createScene();
      gameRunning = true;
    }

    const createScene = () => {
      scene = new BABYLON.Scene(engine);
      scene.clearColor = new BABYLON.Color4(0.05,0.06,0.12,1);

      const camera = new BABYLON.FollowCamera("cam", new BABYLON.Vector3(0,5,-10), scene);
      camera.radius = 10; camera.heightOffset = 4; camera.rotationOffset=180;
      const light = new BABYLON.HemisphericLight("h", new BABYLON.Vector3(0,1,0), scene);

      const laneX = [-3,0,3];
      const roadSegments=[];
      function makeRoad(z) {
        const g=BABYLON.MeshBuilder.CreateGround("g",{width:12,height:30},scene);
        g.position.z=z;
        g.material=new BABYLON.StandardMaterial("m",scene);
        g.material.diffuseColor=new BABYLON.Color3(0.1,0.1+Math.random()*0.1,0.2);
        roadSegments.push(g);
      }
      for(let i=0;i<10;i++) makeRoad(i*30);

      player=BABYLON.MeshBuilder.CreateCapsule("p",{height:2,radius:0.5},scene);
      player.position.set(0,1,0);
      player.material=new BABYLON.StandardMaterial("pm",scene);
      player.material.diffuseColor=charType==="male"?new BABYLON.Color3(0.2,0.6,1):new BABYLON.Color3(1,0.3,0.6);
      camera.lockedTarget=player;

      lane=0;jumping=false;velocityY=0;sliding=false;score=0;coins=0;objects=[];

      function spawnChunk(baseZ) {
        for(let i=0;i<3;i++){
          let x=laneX[i];
          if(Math.random()<0.6){let coin=BABYLON.MeshBuilder.CreateSphere("coin",{diameter:0.6},scene);
            coin.position.set(x,1.2,baseZ+(Math.random()*24-12));
            coin.material=new BABYLON.StandardMaterial("cm",scene);
            coin.material.emissiveColor=new BABYLON.Color3(1,0.9,0.2); objects.push(coin);}
          if(Math.random()<0.4){let h=Math.random()<0.5?1:2.2;
            let obs=BABYLON.MeshBuilder.CreateBox("obs",{width:1.2,height:h,depth:1.2},scene);
            obs.position.set(x,h/2,baseZ+(Math.random()*24-12));
            obs.material=new BABYLON.StandardMaterial("om",scene);
            obs.material.diffuseColor=h>2?new BABYLON.Color3(1,0.2,0.2):new BABYLON.Color3(1,0.5,0.2); objects.push(obs);}
        }
      }
      for(let i=0;i<10;i++) spawnChunk(i*30);

      window.onkeydown=(ev)=>{
        if(ev.key==="ArrowLeft"&&lane>-1)lane--;
        if(ev.key==="ArrowRight"&&lane<1)lane++;
        if(ev.key==="ArrowUp"&&!jumping){jumping=true;velocityY=0.45;}
        if(ev.key==="ArrowDown"&&!sliding&&!jumping){
          sliding=true;player.scaling.y=0.6;setTimeout(()=>{player.scaling.y=1;sliding=false;},600);
        }
      };

      function intersects(a,b){
        return Math.abs(a.position.x-b.position.x)<0.8&&Math.abs(a.position.y-b.position.y)<1.2&&Math.abs(a.position.z-b.position.z)<1.0;
      }

      scene.onBeforeRenderObservable.add(()=>{
        if(!gameRunning)return;
        player.position.z+=0.35;
        player.position.x+=(laneX[lane+1]-player.position.x)*0.2;
        if(jumping){player.position.y+=velocityY;velocityY-=0.03;if(player.position.y<=1){player.position.y=1;jumping=false;}}
        for(let i=0;i<roadSegments.length;i++){let seg=roadSegments[i];if(player.position.z-seg.position.z>45){seg.position.z+=300;spawnChunk(seg.position.z);}}
        score++; document.getElementById("score").innerText=score;
        document.getElementById("coins").innerText=coins;
        for(let i=objects.length-1;i>=0;i--){let o=objects[i];if(!o||o.isDisposed()){objects.splice(i,1);continue;}
          if(o.name==="coin"&&intersects(player,o)){o.dispose();objects.splice(i,1);coins++;}
          else if(o.name==="obs"&&intersects(player,o)){gameOver();}
        }
      });
      return scene;
    };

    function gameOver(){
      gameRunning=false;
      document.getElementById("finalScore").innerText=score;
      show("gameover");
    }

    engine.runRenderLoop(()=>{if(scene)scene.render();});
    window.addEventListener("resize",()=>engine.resize());

    show("splash");
    setTimeout(()=>{show("menu");},2000);
  </script>
</body>
</html>
